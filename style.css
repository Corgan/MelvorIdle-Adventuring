/* Make custom element wrappers invisible to layout */
adventuring-page,
adventuring-overview,
adventuring-overview-button,
adventuring-party,
adventuring-character,
adventuring-abilities,
adventuring-ability,
adventuring-ability-small,
adventuring-ability-details,
adventuring-jobs,
adventuring-job,
adventuring-job-small,
adventuring-job-summary,
adventuring-job-details,
adventuring-auras,
adventuring-aura,
adventuring-aura-instance,
adventuring-stats,
adventuring-card,
adventuring-cards,
adventuring-message-log,
adventuring-message,
adventuring-equipment,
adventuring-equipment-slot,
adventuring-item-base,
adventuring-material,
adventuring-stored-item,
adventuring-dungeon,
adventuring-dungeon-floor,
adventuring-dungeon-cell,
adventuring-encounter,
adventuring-monster,
adventuring-area,
adventuring-building,
adventuring-work-order,
adventuring-town,
adventuring-crossroads,
adventuring-bestiary,
adventuring-armory,
adventuring-stash,
adventuring-trainer,
adventuring-tavern,
adventuring-slayers,
adventuring-lemons,
adventuring-workshop,
adventuring-effect-icon,
adventuring-passive-badge,
adventuring-ability-row,
adventuring-ability-selector-row,
adventuring-job-selector-btn,
adventuring-task-reward,
adventuring-drink-card,
adventuring-stash-category,
adventuring-stat-badge,
adventuring-active-buff-badge,
adventuring-requirement,
adventuring-job-icon,
adventuring-empty-state,
adventuring-achievement-reward,
adventuring-stat-card,
adventuring-dropdown-option,
adventuring-info-message,
adventuring-icon-slot,
adventuring-entity-display,
adventuring-picker-icon,
adventuring-loot-row,
adventuring-icon-button,
adventuring-stat-row,
adventuring-category-section,
adventuring-grimoire-row,
adventuring-badge,
adventuring-monster-ability-row,
adventuring-monster-details,
adventuring-game-guide,
adventuring-tutorial-tooltip,
adventuring-tavern-drink,
adventuring-workshop-product,
adventuring-consumables,
adventuring-consumable,
adventuring-stash-slot {
    display: contents;
}

/* Custom scrollbar styling for ability picker */
.adventuring-scrollbar::-webkit-scrollbar {
    width: 8px;
}

.adventuring-scrollbar::-webkit-scrollbar-track {
    background: rgba(0, 0, 0, 0.2);
    border-radius: 4px;
}

.adventuring-scrollbar::-webkit-scrollbar-thumb {
    background: rgba(255, 255, 255, 0.3);
    border-radius: 4px;
}

.adventuring-scrollbar::-webkit-scrollbar-thumb:hover {
    background: rgba(255, 255, 255, 0.5);
}

/* Firefox scrollbar styling */
.adventuring-scrollbar {
    scrollbar-width: thin;
    scrollbar-color: rgba(255, 255, 255, 0.3) rgba(0, 0, 0, 0.2);
}

/* Job icon color tints using CSS attribute selectors on image src */
/* Matches URLs containing #tint=color */
img[src*="#tint=red"] {
    filter: brightness(0) saturate(100%) invert(31%) sepia(98%) saturate(1234%) hue-rotate(344deg) brightness(95%) contrast(92%);
}
img[src*="#tint=orange"] {
    filter: brightness(0) saturate(100%) invert(61%) sepia(85%) saturate(491%) hue-rotate(347deg) brightness(99%) contrast(95%);
}
img[src*="#tint=yellow"] {
    filter: brightness(0) saturate(100%) invert(83%) sepia(49%) saturate(680%) hue-rotate(358deg) brightness(103%) contrast(101%);
}
img[src*="#tint=green"] {
    filter: brightness(0) saturate(100%) invert(62%) sepia(39%) saturate(522%) hue-rotate(73deg) brightness(95%) contrast(88%);
}
img[src*="#tint=cyan"] {
    filter: brightness(0) saturate(100%) invert(77%) sepia(17%) saturate(867%) hue-rotate(130deg) brightness(92%) contrast(89%);
}
img[src*="#tint=blue"] {
    filter: brightness(0) saturate(100%) invert(45%) sepia(69%) saturate(456%) hue-rotate(176deg) brightness(93%) contrast(92%);
}
img[src*="#tint=purple"] {
    filter: brightness(0) saturate(100%) invert(36%) sepia(63%) saturate(512%) hue-rotate(232deg) brightness(93%) contrast(94%);
}
img[src*="#tint=pink"] {
    filter: brightness(0) saturate(100%) invert(56%) sepia(52%) saturate(456%) hue-rotate(291deg) brightness(97%) contrast(91%);
}
img[src*="#tint=white"] {
    filter: brightness(0) saturate(100%) invert(100%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(103%) contrast(103%);
}
img[src*="#tint=gray"] {
    filter: brightness(0) saturate(100%) invert(50%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(95%) contrast(90%);
}

/* Shade filters - preserve original shading/luminosity while applying color */
/* Uses grayscale to remove saturation, then sepia + hue-rotate to tint */
/* Matches URLs containing #shade=color */
img[src*="#shade=red"] {
    filter: grayscale(1) sepia(1) hue-rotate(-15deg) saturate(2);
}
img[src*="#shade=orange"] {
    filter: grayscale(1) sepia(1) hue-rotate(15deg) saturate(1.8);
}
img[src*="#shade=yellow"] {
    filter: grayscale(1) sepia(1) hue-rotate(30deg) saturate(1.5);
}
img[src*="#shade=green"] {
    filter: grayscale(1) sepia(1) hue-rotate(75deg) saturate(1.5);
}
img[src*="#shade=cyan"] {
    filter: grayscale(1) sepia(1) hue-rotate(130deg) saturate(1.5);
}
img[src*="#shade=blue"] {
    filter: grayscale(1) sepia(1) hue-rotate(180deg) saturate(1.5);
}
img[src*="#shade=purple"] {
    filter: grayscale(1) sepia(1) hue-rotate(230deg) saturate(1.5);
}
img[src*="#shade=pink"] {
    filter: grayscale(1) sepia(1) hue-rotate(290deg) saturate(1.5);
}
img[src*="#shade=magenta"] {
    filter: grayscale(1) sepia(1) hue-rotate(270deg) saturate(2);
}
img[src*="#shade=brown"] {
    filter: grayscale(1) sepia(1) hue-rotate(0deg) saturate(0.8);
}
img[src*="#shade=gold"] {
    filter: grayscale(1) sepia(1) hue-rotate(25deg) saturate(2.5);
}
img[src*="#shade=silver"] {
    filter: grayscale(1) sepia(0.2) saturate(0.3) brightness(1.1);
}
img[src*="#shade=bronze"] {
    filter: grayscale(1) sepia(1) hue-rotate(10deg) saturate(1.2) brightness(0.85);
}
img[src*="#shade=crimson"] {
    filter: grayscale(1) sepia(1) hue-rotate(-25deg) saturate(2.5);
}
img[src*="#shade=lime"] {
    filter: grayscale(1) sepia(1) hue-rotate(60deg) saturate(2.5) brightness(1.2);
}
img[src*="#shade=teal"] {
    filter: grayscale(1) sepia(1) hue-rotate(140deg) saturate(1.8);
}
img[src*="#shade=indigo"] {
    filter: grayscale(1) sepia(1) hue-rotate(200deg) saturate(1.8);
}
img[src*="#shade=violet"] {
    filter: grayscale(1) sepia(1) hue-rotate(250deg) saturate(2.2);
}
img[src*="#shade=rose"] {
    filter: grayscale(1) sepia(1) hue-rotate(310deg) saturate(1.6);
}
img[src*="#shade=amber"] {
    filter: grayscale(1) sepia(1) hue-rotate(30deg) saturate(2.2);
}
img[src*="#shade=coral"] {
    filter: grayscale(1) sepia(1) hue-rotate(5deg) saturate(1.6);
}
img[src*="#shade=emerald"] {
    filter: grayscale(1) sepia(1) hue-rotate(100deg) saturate(2.0);
}
img[src*="#shade=azure"] {
    filter: grayscale(1) sepia(1) hue-rotate(170deg) saturate(2.0);
}
img[src*="#shade=plum"] {
    filter: grayscale(1) sepia(1) hue-rotate(280deg) saturate(1.4) brightness(0.9);
}
img[src*="#shade=olive"] {
    filter: grayscale(1) sepia(1) hue-rotate(55deg) saturate(0.8);
}
img[src*="#shade=salmon"] {
    filter: grayscale(1) sepia(1) hue-rotate(-5deg) saturate(1.2) brightness(1.1);
}
img[src*="#shade=navy"] {
    filter: grayscale(1) sepia(1) hue-rotate(190deg) saturate(1.5) brightness(0.6);
}
img[src*="#shade=mint"] {
    filter: grayscale(1) sepia(1) hue-rotate(120deg) saturate(1.5) brightness(1.2);
}

/* Custom selection state - darker green that doesn't clash with tints */
.adventuring-selected {
    background-color: rgba(40, 90, 50, 0.8) !important;
    border-color: rgba(60, 130, 70, 0.9) !important;
}

/* Override Melvor's selection color for adventuring elements */
adventuring-page .bg-combat-menu-selected,
adventuring-overview .bg-combat-menu-selected,
adventuring-party .bg-combat-menu-selected,
adventuring-character .bg-combat-menu-selected,
adventuring-hero .bg-combat-menu-selected,
adventuring-encounter .bg-combat-menu-selected,
adventuring-dungeon .bg-combat-menu-selected,
adventuring-dungeon-cell .bg-combat-menu-selected,
adventuring-ability .bg-combat-menu-selected,
adventuring-card .bg-combat-menu-selected,
adventuring-job .bg-combat-menu-selected,
adventuring-job-summary .bg-combat-menu-selected {
    background-color: rgba(40, 90, 50, 0.8) !important;
}

/* ========== Tutorial System ========== */

/* Overlay - covers screen and blocks clicks except through the highlight hole */
.adventuring-tutorial-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 2000001;
    pointer-events: auto;
    background: rgba(0, 0, 0, 0.3);
}

/* Highlight ring around target element - allows clicks through */
.adventuring-tutorial-highlight {
    position: fixed;
    border: 3px solid #ffc107;
    border-radius: 8px;
    box-shadow: 0 0 20px rgba(255, 193, 7, 0.6);
    animation: tutorial-pulse 1.5s ease-in-out infinite;
    pointer-events: none;
    z-index: 2000002;
    background: transparent;
}

/* Click blocker for informational steps - blocks clicks but allows hover/tooltips */
.adventuring-tutorial-click-blocker {
    position: fixed;
    z-index: 2000001;
    pointer-events: auto;
    background: transparent;
    cursor: default;
}

@keyframes tutorial-pulse {
    0%, 100% { 
        box-shadow: 0 0 10px rgba(255, 193, 7, 0.4);
    }
    50% { 
        box-shadow: 0 0 25px rgba(255, 193, 7, 0.8);
    }
}

/* Tooltip container */
.adventuring-tutorial-tooltip {
    position: fixed;
    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
    border: 2px solid #ffc107;
    border-radius: 8px;
    padding: 14px 18px;
    max-width: 320px;
    min-width: 200px;
    z-index: 2000002;
    box-shadow: 0 4px 24px rgba(0, 0, 0, 0.6);
    pointer-events: auto;
}

/* Tooltip message text */
.tutorial-message {
    color: #e0e0e0;
    font-size: 14px;
    line-height: 1.5;
}

/* Action links container */
.tutorial-actions {
    text-align: right;
    border-top: 1px solid rgba(255, 193, 7, 0.2);
    padding-top: 8px;
}

/* Arrow pointing to target */
.tutorial-arrow {
    position: absolute;
    width: 0;
    height: 0;
}

/* Arrow pointing up (tooltip is below target) */
.tutorial-arrow-bottom {
    top: -10px;
    left: 50%;
    transform: translateX(-50%);
    border-left: 10px solid transparent;
    border-right: 10px solid transparent;
    border-bottom: 10px solid #ffc107;
}

/* Arrow pointing down (tooltip is above target) */
.tutorial-arrow-top {
    bottom: -10px;
    left: 50%;
    transform: translateX(-50%);
    border-left: 10px solid transparent;
    border-right: 10px solid transparent;
    border-top: 10px solid #ffc107;
}

/* Arrow pointing left (tooltip is to the right of target) */
.tutorial-arrow-right {
    left: -10px;
    top: 50%;
    transform: translateY(-50%);
    border-top: 10px solid transparent;
    border-bottom: 10px solid transparent;
    border-right: 10px solid #ffc107;
}

/* Arrow pointing right (tooltip is to the left of target) */
.tutorial-arrow-left {
    right: -10px;
    top: 50%;
    transform: translateY(-50%);
    border-top: 10px solid transparent;
    border-bottom: 10px solid transparent;
    border-left: 10px solid #ffc107;
}

/* Active buffs display */
.adventuring-buff-icon {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 32px;
    height: 32px;
    background: rgba(0, 0, 0, 0.2);
    border-radius: 4px;
    cursor: pointer;
}

.adventuring-buff-icon img {
    width: 24px;
    height: 24px;
}

/* Tint filters for difficulty icons */
.adventuring-buff-icon.text-success img {
    filter: sepia(1) saturate(5) hue-rotate(85deg) brightness(0.9);
}

.adventuring-buff-icon.text-warning img {
    filter: sepia(1) saturate(5) hue-rotate(15deg) brightness(1.1);
}

.adventuring-buff-icon.text-danger img {
    filter: sepia(1) saturate(5) hue-rotate(-10deg) brightness(0.9);
}

.adventuring-buff-icon.text-info img {
    filter: sepia(1) saturate(5) hue-rotate(175deg) brightness(1.1);
}

/* Item selector popup */
.adventuring-item-selector {
    padding: 8px;
    min-width: 200px;
    max-width: 300px;
}

.adventuring-item-selector-item {
    transition: all 0.15s ease;
    background: rgba(0, 0, 0, 0.2);
}

.adventuring-item-selector-item:hover {
    background: rgba(255, 255, 255, 0.1);
    transform: scale(1.05);
    border-color: #ffc107 !important;
}

/* Message log rarity colors */
adventuring-message.msg-info small#body {
    color: #adb5bd;
}

adventuring-message.msg-rare small#body {
    color: #5bc0de;
    font-weight: 600;
}

adventuring-message.msg-epic small#body {
    color: #9b59b6;
    font-weight: 700;
}

adventuring-message.msg-legendary small#body {
    color: #f1c40f;
    font-weight: 700;
    text-shadow: 0 0 8px rgba(241, 196, 15, 0.5);
}

/* Stat Breakdown Tooltip */
.stat-breakdown-tooltip {
    min-width: 280px;
    max-width: 400px;
    font-size: 12px;
    background: #1a1a2e;
    border: 1px solid #3d3d5c;
    border-radius: 6px;
    overflow: hidden;
}

.stat-breakdown-header {
    display: flex;
    align-items: center;
    padding: 10px 12px;
    background: linear-gradient(135deg, #2d2d44 0%, #1a1a2e 100%);
    border-bottom: 1px solid #3d3d5c;
}

.stat-breakdown-header-icon {
    width: 24px;
    height: 24px;
    margin-right: 10px;
}

.stat-breakdown-header-name {
    font-weight: 600;
    color: #e0e0e0;
    flex-grow: 1;
}

.stat-breakdown-header-value {
    font-weight: 700;
    font-size: 16px;
    color: #4dabf7;
}

.stat-breakdown-body {
    padding: 8px 0;
}

.stat-breakdown-section {
    border-bottom: 1px solid #2d2d44;
}

.stat-breakdown-section:last-child {
    border-bottom: none;
}

.stat-breakdown-section-header {
    display: flex;
    align-items: center;
    padding: 6px 12px;
    cursor: pointer;
    transition: background 0.15s;
}

.stat-breakdown-section-header:hover {
    background: rgba(255,255,255,0.05);
}

.stat-breakdown-toggle {
    width: 16px;
    margin-right: 6px;
    color: #888;
    font-size: 10px;
    user-select: none;
}

.stat-breakdown-section-title {
    flex-grow: 1;
    font-weight: 600;
    color: #c0c0c0;
}

.stat-breakdown-section-total {
    font-weight: 600;
}

.stat-breakdown-positive .stat-breakdown-section-total {
    color: #51cf66;
}

.stat-breakdown-negative .stat-breakdown-section-total {
    color: #ff6b6b;
}

.stat-breakdown-combat .stat-breakdown-section-total {
    color: #fcc419;
}

.stat-breakdown-section-content {
    overflow: hidden;
    max-height: 1000px;
    transition: max-height 0.2s ease-out;
}

.stat-breakdown-section-content.collapsed {
    max-height: 0;
}

.stat-breakdown-row {
    display: flex;
    align-items: center;
    padding: 4px 12px;
    color: #a0a0a0;
}

.stat-breakdown-row.stat-breakdown-base {
    padding: 6px 12px;
}

.stat-breakdown-depth-1 {
    padding-left: 28px;
}

.stat-breakdown-depth-2 {
    padding-left: 44px;
    font-size: 11px;
    color: #808080;
}

.stat-breakdown-depth-3 {
    padding-left: 60px;
    font-size: 11px;
    color: #707070;
}

.stat-breakdown-icon {
    width: 16px;
    height: 16px;
    margin-right: 6px;
}

.stat-breakdown-label {
    flex-grow: 1;
}

.stat-breakdown-value {
    font-weight: 500;
    color: #c0c0c0;
}

.stat-breakdown-collapsible {
    cursor: pointer;
}

.stat-breakdown-collapsible:hover {
    background: rgba(255,255,255,0.03);
}

.stat-breakdown-sub-content {
    overflow: hidden;
    max-height: 500px;
    transition: max-height 0.15s ease-out;
}

.stat-breakdown-sub-content.collapsed {
    max-height: 0;
}

.stat-breakdown-subsection {
    margin: 4px 0;
}

.stat-breakdown-subsection-header {
    display: flex;
    align-items: center;
    padding: 4px 12px 4px 28px;
    cursor: pointer;
    font-weight: 500;
}

.stat-breakdown-subsection-header:hover {
    background: rgba(255,255,255,0.03);
}

.stat-breakdown-buff {
    color: #51cf66;
}

.stat-breakdown-debuff {
    color: #ff6b6b;
}

.stat-breakdown-subsection-content {
    overflow: hidden;
    max-height: 300px;
    transition: max-height 0.15s ease-out;
}

.stat-breakdown-subsection-content.collapsed {
    max-height: 0;
}

.stat-breakdown-footer {
    padding: 8px 12px;
    background: #0d0d1a;
    border-top: 1px solid #2d2d44;
}

.stat-breakdown-calc {
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: monospace;
}

.stat-breakdown-formula {
    color: #888;
}

.stat-breakdown-equals {
    margin: 0 8px;
    color: #666;
}

.stat-breakdown-final {
    font-weight: 700;
    font-size: 14px;
    color: #4dabf7;
}

/* ============================================
   Town Layout
   ============================================ */

.adventuring-town-container {
    position: relative;
    width: 750px;
    height: 650px;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: inset 0 0 15px rgba(0, 0, 0, 0.4);
}

.adventuring-town-background {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
}

/* Building hover effect */
.adventuring-town-container adventuring-building .pointer-enabled {
    transition: transform 0.15s ease, filter 0.15s ease;
    z-index: 1;
}

.adventuring-town-container adventuring-building .pointer-enabled:hover {
    transform: scale(1.08);
    filter: brightness(1.15) drop-shadow(0 4px 8px rgba(0, 0, 0, 0.4));
    z-index: 10;
}

/* ========== Town Map Styles ========== */

.town-map-container {
    width: 100%;
    padding: 1rem;
    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
    border-radius: 12px;
}

.town-map-wrapper {
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 
        0 8px 32px rgba(0, 0, 0, 0.4),
        inset 0 0 0 2px rgba(255, 255, 255, 0.1);
}

.town-map-base svg {
    display: block;
}

/* Building styles */
.town-building {
    transform-origin: center center;
}

.town-building img {
    transition: filter 0.2s ease;
}

.town-building:hover {
    z-index: 100 !important;
}

.town-building.locked {
    opacity: 0.6;
}

.town-building.locked:hover {
    opacity: 0.8;
}

.town-building.selected {
    filter: drop-shadow(0 0 15px gold) !important;
}

/* Locked building placeholder */
.building-locked-placeholder {
    background: rgba(0, 0, 0, 0.4) !important;
    backdrop-filter: blur(2px);
}

/* Tooltip styles */
.town-building-tooltip {
    animation: tooltipFadeIn 0.15s ease;
}

.town-building-tooltip .tooltip-title {
    font-weight: bold;
    font-size: 1.1em;
    margin-bottom: 4px;
}

.town-building-tooltip .tooltip-district {
    color: #aaa;
    font-size: 0.9em;
}

.town-building-tooltip .tooltip-locked {
    color: #ff6b6b;
    margin-top: 4px;
    font-size: 0.85em;
}

@keyframes tooltipFadeIn {
    from {
        opacity: 0;
        transform: translateY(5px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Map error state */
.town-map-error {
    display: flex;
    align-items: center;
    justify-content: center;
    height: 400px;
    color: #ff6b6b;
    font-size: 1.2em;
}

/* District highlighting */
.town-building.district-highlight {
    animation: districtPulse 1.5s ease-in-out infinite;
}

@keyframes districtPulse {
    0%, 100% {
        filter: drop-shadow(0 0 8px rgba(255, 215, 0, 0.6));
    }
    50% {
        filter: drop-shadow(0 0 20px rgba(255, 215, 0, 0.9));
    }
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .town-map-container {
        padding: 0.5rem;
    }
    
    .town-building-tooltip {
        font-size: 12px;
        padding: 6px 10px;
    }
}
